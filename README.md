This is a MERGED version of both branches.